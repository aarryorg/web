<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thumbly AI - AI Thumbnail Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .lds-ring {
            display: inline-block;
            position: relative;
            width: 40px;
            height: 40px;
        }
        .lds-ring div {
            box-sizing: border-box;
            display: block;
            position: absolute;
            width: 32px;
            height: 32px;
            margin: 4px;
            border: 4px solid #fff;
            border-radius: 50%;
            animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
            border-color: #fff transparent transparent transparent;
        }
        .lds-ring div:nth-child(1) {
            animation-delay: -0.45s;
        }
        .lds-ring div:nth-child(2) {
            animation-delay: -0.3s;
        }
        .lds-ring div:nth-child(3) {
            animation-delay: -0.15s;
        }
        @keyframes lds-ring {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900/50 to-gray-900 p-4 sm:p-6 lg:p-8">
        <div class="max-w-6xl mx-auto">

            <!-- Header -->
            <header class="text-center py-12">
                <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400 mb-4">
                    Thumbly AI
                </h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto">
                    Create stunning, click-worthy YouTube thumbnails in seconds. Leverage AI to generate unique images from text or instantly grab high-quality thumbnails from any video URL.
                </p>
                <a href="#generator" class="mt-8 inline-block bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full transition-transform duration-300 transform hover:scale-105">
                    Start Creating Now
                </a>
            </header>

            <!-- Features Section -->
            <section class="py-16">
                <div class="grid md:grid-cols-3 gap-8 text-center">
                    <div class="glassmorphism p-8 rounded-2xl">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-purple-500/20 mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-400"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">AI-Powered Creativity</h3>
                        <p class="text-gray-400">Describe your ideal thumbnail and let our AI bring it to life with vibrant, unique imagery tailored to your content.</p>
                    </div>
                    <div class="glassmorphism p-8 rounded-2xl">
                         <div class="flex items-center justify-center h-16 w-16 rounded-full bg-cyan-500/20 mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-cyan-400"><path d="M15 2H9a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z"/><path d="M12 18h.01"/></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Instant URL Grabber</h3>
                        <p class="text-gray-400">Need a thumbnail fast? Just paste any YouTube video URL to instantly download its highest-resolution thumbnail.</p>
                    </div>
                    <div class="glassmorphism p-8 rounded-2xl">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-green-500/20 mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-400"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">High-Quality Downloads</h3>
                        <p class="text-gray-400">Export your generated thumbnails in high quality, ready to be uploaded directly to YouTube to capture your audience's attention.</p>
                    </div>
                </div>
            </section>

            <!-- Generator Section -->
            <section id="generator" class="pt-16">
                <div class="w-full max-w-3xl mx-auto bg-gray-800/50 rounded-2xl shadow-2xl p-6 md:p-10 border border-gray-700">
                    <div class="text-center mb-6">
                        <h2 class="text-3xl md:text-4xl font-bold text-cyan-400">Create Your Thumbnail</h2>
                        <p class="text-gray-400 mt-2">Enter a URL or a descriptive prompt below.</p>
                    </div>
                    <div class="space-y-4 mb-6">
                        <label for="youtube-url-input" class="block text-gray-300 text-sm font-semibold">YouTube Video URL (Optional)</label>
                        <input type="text" id="youtube-url-input" class="w-full p-3 bg-gray-700 rounded-lg border border-gray-600 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-shadow duration-300" placeholder="e.g., https://www.youtube.com/watch?v=dQw4w9WgXcQ">
                        <div class="flex items-center justify-center text-gray-400 text-sm">
                            <span class="w-full border-t border-gray-600"></span>
                            <span class="mx-4 font-bold">OR</span>
                            <span class="w-full border-t border-gray-600"></span>
                        </div>
                        <label for="prompt-input" class="block text-gray-300 text-sm font-semibold">Prompt for AI Thumbnail (Overrides YouTube URL if both are provided)</label>
                        <textarea id="prompt-input" rows="3" class="w-full p-4 bg-gray-700 rounded-lg border border-gray-600 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-shadow duration-300 resize-none" placeholder="e.g., A majestic lion wearing a crown, cinematic lighting"></textarea>
                        <button id="generate-btn" class="w-full flex items-center justify-center gap-2 py-3 px-4 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                            Generate Thumbnails
                        </button>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-xl font-semibold text-gray-300 mb-3">Your Generated Thumbnails:</h3>
                        <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Thumbnails will be injected here -->
                            <div id="loader-container" class="col-span-full hidden flex-col items-center justify-center min-h-[200px] bg-gray-900 rounded-lg border border-gray-700 p-4">
                                <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
                                <p class="mt-2 text-sm text-gray-400">Generating AI thumbnails...</p>
                            </div>
                            <p id="placeholder" class="col-span-full text-gray-500 px-4 text-center min-h-[200px] flex items-center justify-center">Your generated thumbnails will appear here.</p>
                            <p id="error-message" class="col-span-full text-red-400 hidden text-center p-4 bg-red-900/20 rounded-lg"></p>
                        </div>
                    </div>
                </div>
            </section>

             <!-- Footer -->
            <footer class="text-center py-12 mt-16 border-t border-gray-800">
                <p class="text-gray-500">&copy; 2024 Thumbly AI. All Rights Reserved.</p>
            </footer>
        </div>
    </div>

    <script>
        const generateBtn = document.getElementById('generate-btn');
        const youtubeUrlInput = document.getElementById('youtube-url-input');
        const promptInput = document.getElementById('prompt-input');
        const resultsGrid = document.getElementById('results-grid');
        const placeholder = document.getElementById('placeholder');
        const loaderContainer = document.getElementById('loader-container');
        const errorMessage = document.getElementById('error-message');

        generateBtn.addEventListener('click', generateThumbnails);
        
        promptInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                generateThumbnails();
            }
        });

        async function generateThumbnails() {
            const youtubeUrl = youtubeUrlInput.value.trim();
            let prompt = promptInput.value.trim();

            if (!youtubeUrl && !prompt) {
                showError("Please enter either a YouTube URL or a descriptive prompt to generate thumbnails.");
                return;
            }
            
            showLoading(true);
            resultsGrid.innerHTML = ''; // Clear previous results

            try {
                let finalPrompt = prompt;

                // If YouTube URL is provided and no specific prompt, try to infer prompt from video
                if (youtubeUrl && !prompt) {
                    const videoIdMatch = youtubeUrl.match(/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/|v\/|)([\w-]{11})(?:\S+)?/);
                    if (videoIdMatch && videoIdMatch[1]) {
                        const videoId = videoIdMatch[1];
                        // Attempt to fetch video title/description using google_search
                        const searchResults = await google_search.search({
                            queries: [`YouTube video "${videoId}" title and description`]
                        });

                        let videoTitle = '';
                        let videoDescription = '';

                        if (searchResults && searchResults.length > 0 && searchResults[0].results && searchResults[0].results.length > 0) {
                            for (const result of searchResults[0].results) {
                                if (result.snippet) {
                                    // Try to parse title and description from snippet
                                    const titleMatch = result.snippet.match(/(?:title|Title)[:\s]*([^\n]+)/);
                                    if (titleMatch && titleMatch[1]) {
                                        videoTitle = titleMatch[1].trim();
                                    }
                                    const descriptionMatch = result.snippet.match(/(?:description|Description)[:\s]*([^\n]+)/);
                                    if (descriptionMatch && descriptionMatch[1]) {
                                        videoDescription = descriptionMatch[1].trim();
                                    }

                                    if (videoTitle || videoDescription) break; // Found enough info
                                }
                            }
                        }

                        if (videoTitle || videoDescription) {
                            finalPrompt = `Create a visually striking YouTube thumbnail for a video titled "${videoTitle || 'Untitled Video'}". ${videoDescription ? `The video is about: "${videoDescription}".` : ''} Focus on a captivating and relevant image.`;
                        } else {
                            finalPrompt = `Create a visually striking YouTube thumbnail for a YouTube video from URL: ${youtubeUrl}. Focus on a captivating and relevant image.`;
                        }
                    } else {
                        throw new Error("Invalid YouTube URL provided. Please check the format.");
                    }
                } else if (!prompt && !youtubeUrl) {
                    showError("Please provide either a YouTube URL or a text prompt.");
                    return;
                } else if (prompt && youtubeUrl) {
                    // If both are provided, the explicit prompt takes precedence for AI generation
                    finalPrompt = prompt;
                } else if (prompt) {
                    finalPrompt = prompt;
                }

                if (!finalPrompt) {
                     showError("Could not determine a valid prompt for AI thumbnail generation.");
                     return;
                }

                const apiKey = ""; // Canvas environment provides this
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
                const payload = {
                    instances: { prompt: finalPrompt },
                    parameters: { "sampleCount": 4 } // Request 4 thumbnails
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! Status: ${response.status}`);
                }
                const result = await response.json();
                
                if (result.predictions && result.predictions.length > 0) {
                    displayGeneratedThumbnails(result.predictions);
                } else {
                    showError("No images were generated. Please try a different prompt.");
                }

            } catch (error) {
                console.error("Error generating thumbnails:", error);
                showError(`An error occurred: ${error.message}.`);
            } finally {
                showLoading(false);
            }
        }

        function displayGeneratedThumbnails(predictions) {
            placeholder.classList.add('hidden');
            errorMessage.classList.add('hidden');
            resultsGrid.innerHTML = ''; // Clear previous results

            predictions.forEach((prediction, index) => {
                if (prediction.bytesBase64Encoded) {
                    const imageUrl = `data:image/png;base64,${prediction.bytesBase64Encoded}`;
                    const thumbnailHtml = `
                        <div class="relative w-full aspect-video bg-gray-900 rounded-lg border border-gray-700 overflow-hidden group">
                            <img src="${imageUrl}" alt="Generated Thumbnail ${index + 1}" class="w-full h-full object-cover rounded-md">
                            <a href="${imageUrl}" download="ai_generated_thumbnail_${index + 1}.png" 
                               class="absolute bottom-4 right-4 bg-green-600 hover:bg-green-700 text-white p-2 rounded-full shadow-lg transition-all duration-300 transform scale-100 opacity-100" 
                               title="Download Thumbnail ${index + 1}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                            </a>
                        </div>
                    `;
                    resultsGrid.innerHTML += thumbnailHtml;
                }
            });

            if (resultsGrid.innerHTML === '') {
                showError("No valid thumbnails were generated. Please refine your prompt.");
            }
        }

        function showLoading(isLoading) {
            if (isLoading) {
                loaderContainer.classList.remove('hidden');
                loaderContainer.classList.add('flex');
                placeholder.classList.add('hidden');
                errorMessage.classList.add('hidden');
                resultsGrid.innerHTML = ''; // Clear existing images
                generateBtn.disabled = true;
                generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                loaderContainer.classList.add('hidden');
                loaderContainer.classList.remove('flex');
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            placeholder.classList.add('hidden'); // Ensure placeholder is hidden if error
            loaderContainer.classList.add('hidden');
            loaderContainer.classList.remove('flex');
            resultsGrid.innerHTML = ''; // Clear any partial results
            generateBtn.disabled = false;
            generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    </script>
</body>
</html>

